<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        body { height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-family: -apple-system, sans-serif; }
        #status { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; }
        .device { font-size: 18px; margin: 10px 0; }
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        button { background: #0088cc; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="status">
        <div class="spinner"></div>
        <div class="device" id="device">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è fingerprint...</div>
        <div id="features">Canvas/WebGL —Å–ø—É—Ñ...</div>
        <button onclick="openMarket()" id="btn" style="display:none;">üöÄ –û—Ç–∫—Ä—ã—Ç—å Market</button>
    </div>
    <script>
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setText('üöÄ Market').show().onClick(openMarket);
        
        // üé≤ –ù–û–í–´–ô FINGERPRINT (–∏–∑ antidirect.js)
        const UAs = [
            'Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1',
            'Mozilla/5.0 (Linux; Android 14; SM-S928B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1'
        ];
        const randomUA = UAs[Math.floor(Math.random()*UAs.length)];
        const isIphone = randomUA.includes('iPhone');
        
        // ‚úÖ –ü–†–ò–ú–ï–ù–Ø–ï–ú –ê–ù–¢–ò–î–ï–¢–ï–ö–¢
        Object.defineProperty(navigator, 'userAgent', {get: ()=>randomUA});
        Object.defineProperty(navigator, 'platform', {get: ()=>isIphone?'iPhone':'Linux armv8l'});
        Object.defineProperty(screen, 'width', {get: ()=>isIphone?393:412});
        Object.defineProperty(screen, 'height', {get: ()=>isIphone?852:915});
        Object.defineProperty(navigator, 'webdriver', {get: ()=>false});
        Object.defineProperty(navigator, 'languages', {get: ()=>['ru-RU','ru','en']});
        
        // Canvas/WebGL (–∏–∑ —Ç–≤–æ–µ–≥–æ antidirect.js)
        (function(){
            const origToDataURL = HTMLCanvasElement.prototype.toDataURL;
            HTMLCanvasElement.prototype.toDataURL = function(type){
                if(type==='image/png'){
                    const ctx = this.getContext('2d');
                    const data = ctx.getImageData(0,0,this.width,this.height);
                    for(let i=0; i<data.data.length; i+=4){
                        data.data[i] += Math.floor(Math.random()*5);
                        data.data[i+1] += Math.floor(Math.random()*5);
                        data.data[i+2] += Math.floor(Math.random()*5);
                    }
                    ctx.putImageData(data,0,0);
                }
                return origToDataURL.call(this,type);
            };
            
            const getParam = WebGLRenderingContext.prototype.getParameter;
            WebGLRenderingContext.prototype.getParameter = function(p){
                if(p===37445) return isIphone ? 'Apple Inc.' : 'Samsung Electronics Co., Ltd';
                if(p===37446) return isIphone ? 'Apple GPU' : 'Adreno (TM) 750';
                return getParam.call(this,p);
            };
        })();
        
        // ‚úÖ UI + Market
        setTimeout(() => {
            document.getElementById('device').textContent = `${isIphone ? 'iPhone Safari' : 'Android Chrome'} –≥–æ—Ç–æ–≤!`;
            document.getElementById('features').innerHTML = '‚úÖ Canvas/WebGL/Screen —Å–ø—É—Ñ';
            document.getElementById('btn').style.display = 'block';
        }, 1000);
        
        function openMarket() {
            // Market –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç–æ–º!
            Telegram.WebApp.openLink('https://m.market.yandex.ru');
        }
    </script>
</body>
</html>
